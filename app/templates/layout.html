<!DOCTYPE html>
<!--[if lt IE 7]>      <html class="no-js lt-ie9 lt-ie8 lt-ie7"> <![endif]-->
<!--[if IE 7]>         <html class="no-js lt-ie9 lt-ie8"> <![endif]-->
<!--[if IE 8]>         <html class="no-js lt-ie9"> <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js"> <!--<![endif]-->
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <title>PPP Loan Data</title>
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">
        <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
        <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.6.3/css/all.css" integrity="sha384-UHRtZLI+pbxtHCWp1t77Bi1L4ZtiqrqD80Kn4Z8NTSRyMA2Fd33n5dQ8lWUE00s/" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/akottr/dragtable@master/dragtable.css">
        <link rel="stylesheet" href="https://unpkg.com/placeholder-loading/dist/css/placeholder-loading.min.css">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.17.1/dist/bootstrap-table.min.css">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/page-jump-to/bootstrap-table-page-jump-to.min.css">
        <link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/filter-control/bootstrap-table-filter-control.css">

        <!-- Particle background stylesheets -->
        <!-- <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/1.0.0/css/materialize.min.css" /> -->
        <!-- <link rel="stylesheet" href="css/particle-style.css"> -->


        <link rel="stylesheet" type="text/css" href= "{{ url_for('static',filename='css/home.css') }}">

    </head>

<body>
        {% block content %}{% endblock %}


        <script src="https://cdn.jsdelivr.net/npm/particles.js@2.0.0/particles.min.js"></script>
    
        <script>
            particlesJS.load('particles-js',
                'particles.json', function() {
                    console.log('callback - particles.js config loaded');
                });
        </script>
        






    <!-- JS LIBRARIES -->

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>

    <!-- Export data -->
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js"></script>
    <script src="https://unpkg.com/tableexport.jquery.plugin/libs/jsPDF/jspdf.min.js"></script>
    <script src="https://unpkg.com/tableexport.jquery.plugin/libs/jsPDF-AutoTable/jspdf.plugin.autotable.js"></script> 
    <script src="https://unpkg.com/tableexport.jquery.plugin/tableExport.min.js"></script>

    <!-- Reorder columns -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jqueryui/1.12.1/jquery-ui.min.js"></script>
    <script src="https://cdn.jsdelivr.net/gh/akottr/dragtable@master/jquery.dragtable.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.7/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.3.1/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/bootstrap-table.min.js"></script>

    <!-- Extensions -->
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/addrbar/bootstrap-table-addrbar.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/export/bootstrap-table-export.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/mobile/bootstrap-table-mobile.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/page-jump-to/bootstrap-table-page-jump-to.min.js"></script>
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/print/bootstrap-table-print.min.js"></script>
    <!-- <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/reorder-columns/bootstrap-table-reorder-columns.min.js"></script> -->


    <!-- <script src="{{ url_for('static',filename='js/bootstrap-table-filter-control.js') }}"></script> -->
    <script src="https://unpkg.com/bootstrap-table@1.17.1/dist/extensions/filter-control/bootstrap-table-filter-control.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap-table/1.14.1/locale/bootstrap-table-en-US.min.js"></script>


    <!-- Get column options -->
    <script>var colOptions;</script>
    <script>
        function getColumnNames() {
            console.log("IN GET COLUMNS")
            // console.log(params)
            var request = new XMLHttpRequest();
            request.open('GET', 'http://localhost:5000/header_options/', false);  // `false` makes the request synchronous
            request.send(null);

            if (request.status === 200) {
                colOptions = JSON.parse(request.responseText);
            }
        }
        getColumnNames()
    </script>

    <!-- Reset button -->
    <script>
        var $table = $('#table')
        var $resetButton = $('#resetButton')
    </script>

    <!-- Get data -->
    <script>
            function ajaxRequest(params) {
                var url = '/params'
                $.get(url + '?' + $.param(params.data))
                .then(function (res) {
                    params.success(res)
                    console.log(res)
                });
            };
    </script>

    <!-- Format loan amount data -->        
    <script>
        function amountFormatter(value) {
            return value.substring(0, value.length - 3)
        }
    </script>

    <!-- Custom text for loading message, footer, search box placeholder, no match found -->
    <script>        
        (function ($) {
            'use strict';
            $.fn.bootstrapTable.locales['en-US-custom'] = {
                formatLoadingMessage: function () {
                    return 'Doing government work';
                },
                formatRecordsPerPage: function (pageNumber) {
                    return pageNumber + ' results per page';
                },
                formatShowingRows: function (pageFrom, pageTo, totalRows) {
                    return 'Showing ' + pageFrom.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' to ' + pageTo.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' of ' + totalRows.toString().replace(/\B(?=(\d{3})+(?!\d))/g, ",") + ' loans';
                },
                formatSearch: function () {
                    return 'Search all columns';
                },
                formatNoMatches: function () {
                    return 'There are no loans in the center of that particular Venn diagram...<br><br>¯\\_(ツ)_/¯<br><br>but don\'t give up! Try it again with fewer filters.';
                },
                formatExport: function () {
                    return 'Export page'
                }
            };
            $.extend($.fn.bootstrapTable.defaults, $.fn.bootstrapTable.locales['en-US-custom']);
        })(jQuery);
    </script>

    <!-- Format data when a row is expanded -->
    <script>

        var orderedData = {
            "loanamount": "Loan Amount",
            "city": "City",
            "state": "State",                
            "zip": "ZIP Code",
            "naicscode": "NAICS Code",
            "businesstype": "Business Type",
            "raceethnicity": "Race/Ethnicity",
            "gender": "Gender",
            "veteran": "Veteran",
            "nonprofit": "Nonprofit",
            "jobsretained": "Jobs Retained",
            "dateapproved": "Date Approved",
            "lender": "Lender",
            "cd": "House District"
            }

        function getOrderedColumns() {
            return Object.values(orderedData)
        }

        function reorderValues(row) {
            var orderedValues = []
            $.each(Object.keys(orderedData), function(index, value) {
                orderedValues.push(row[value])
            })
            return orderedValues
        }

        function formatValues(values) {
            var i;
            for (i = 0; i < values.length; i++) { 
                if (values[i] == null) {
                    values[i] = "N/A"
                }
            }
            return values
        }

        function detailFormatter(index, row) {
            var orderedColumns = getOrderedColumns()
            var orderedValues = reorderValues(row)
            orderedValues = formatValues(orderedValues)

            var html = ['<div class="detailview">']
            var i = 0
            $.each(orderedColumns, function (index, columnName) {
                html.push('<p><b>' + columnName + ':</b> ' + orderedValues[i] + '</p>')
                i += 1
            })
            html.push('</div>')
            return html.join('')
        }
    </script>

    <!-- Reset table button -->
    <script>
        $(function() {
            $resetButton.click(function () {
                $table.bootstrapTable('destroy')
                $table.bootstrapTable()
            })
        })
    </script>

    <!-- Loading screen overlay -->
        <script>
            var type = 'bsGrow'
        
            function loadingTemplate(message) {
                
                if (type === 'fa') {
                    return '<i class="spinner-text" color:#007aff;font-size:32px;">Doing government work...&nbsp;&nbsp;</i><i style="color:#007aff;" class="fa fa-spinner fa-spin fa-fw fa-2x spinner-spinner"></i>'
                }
                if (type === 'pl') {
                    return '<div class="ph-item"><div class="ph-picture"></div></div>'
                }
                if (type === 'bsGrow') {
                    return '<i class="spinner-text text-primary";">Doing government work...&nbsp;&nbsp;</i><i class="spinner-grow text-primary spinner-spinner" role="status"><span class="sr-only">Loading...</span></i>'
                }
            }
        </script>

    <!-- Fix for Toggle All issue where table overlaps bottom pagination controls -->
    <script>
        $('#table').on('post-body.bs.table', function (e, arg1, arg2) {
            console.log('POST BODY RAN')
            $table.bootstrapTable('resetView')
            $('div.hidden').fadeIn(2000).removeClass('hidden');
        });

        // $('#table').on('toggle.bs.table', function (e, arg1, arg2) {
        //     console.log('TOGGLE RAN')
        //         $table.bootstrapTable('resetView')
        //         console.log("THIS THING HAPPENED")
        //     });
        // </script>

<!-- <script>
$('#table').on('all.bs.table', function (data, event) {
    console.log(event)
    // console.log(data)
    // $table.bootstrapTable('resetView')

    });
</script> -->



    <!-- <script>
        $('#table').on('pre-body.bs.table', function (e, arg1, arg2) {
            console.log('PRE BODY RAN')
            $('div.hidden').fadeIn(2000).removeClass('hidden');

        });
    </script> -->

    <!-- NOT CURRENTLY IN USE: -->

        <!-- Fade in -->
        <!-- <script>
                $(document).ready(function () {
                    $('div.hidden').fadeIn(2000).removeClass('hidden');
                });
        </script> -->

        <!-- Action before table loads -->
        <!-- <script>
        $('#table').on('pre-body.bs.table', function (e, arg1, arg2) {
                    console.log('HELLO END')
                    var userJobTitles9
                    fetch("http://localhost:5000/data_test/businesstype.json")
                    .then(response => response.json())
                    .then(response => {
                        console.log("JSON IS THIS:")
                        console.log(response);
                        userJobTitles9 = response
                        console.log("ASSIGNED VARIABLE IS THIS:")
                        console.log(userJobTitles9);
                    }, error => {
                        console.error(error);
                    })
                });   
        </script> -->

        <!-- Action on change to columns -->
        <!-- <script>
            $('#table').on('column-switch.bs.table', function (e, arg1, arg2) {
                console.log('COLUMN SWITCH')
                $table.bootstrapTable('resetView')
                $table.bootstrapTable()
            })
            // onColumnSwitch
        </script>
        -->

        <!-- Data export -->
        <!-- <script>
            $(function() {
                $('#toolbar').find('select').change(function () {
                $table.bootstrapTable('destroy').bootstrapTable({
                    exportDataType: $(this).val(),
                    exportTypes: ['json', 'xml', 'csv', 'txt', 'sql', 'pdf']
                })
                }).trigger('change')
            });
        </script> -->

        <!-- Column headers without search or filtering -->
        <!-- <script>
            $( "div:contains('Loan Amount'):last" ).parent().css({"vertical-align":"top"});
            $( "div:contains('Jobs Retained'):last" ).parent().css({"vertical-align":"top"});

            function headerStyle(column) {
                return {
                    loanamount: {
                    css: {'vertical-align': 'top'}
                    },
                    jobsretained: {
                    css: {'vertical-align': 'top'}
                    }
                }[column.field]
            }
        </script> -->

        <!-- Export Data settings
        <script>
            $table.bootstrapTable(
                {
                    exportTypes: ['csv', 'txt', 'doc', 'pdf', 'json', 'xml', 'sql'],
                    exportOptions: {
                        fileName: 'ppp_data',
                        ignoreColumn: [0]
                    }
                }
            )
        </script> -->




        <!-- Old get data -->
        <script>
            // let url = 'http://localhost:5000/data_test/businesstype.json';
            // userJobTitles2 = {
            //     'state': {
            //         Admin: 'Admin',
            //         IT: randomnum,
            //         General : 'General',
            //         Security : 'Security',
            //         CEO : 'CEO',
            //     },
            //     'zip': {
            //         Admin: 'Admin',
            //         CEO: randomnum
            //     },
            //     'businesstype': {
            //         BusinessType_1: 'BT 1',
            //         BusinessType_2: 'BT 2'
            //     }
            // };
            // console.log("FIRST PRINT")
            // console.log(userJobTitles2)

            // userJobTitles2 = fetch(url)
            // .then(res => res.json())
            // .then((out) => {
            // console.log('Checkout this JSON! ', out);
            // // userJobTitles2 = out
            // // console.log("IN METHOD:")
            // // console.log(userJobTitles2)
            // // console.log(userJobTitles2.businesstype)
            // })
            // .catch(err => { throw err });
            // console.log("SECOND PRINT")
            // console.log(userJobTitles2)
            // console.log("THIS IS THE VARIABLE LOGGED:")
            // console.log(userJobTitles2)
            // userJobTitles2 = $.get('http://localhost:5000/data_test/businesstype.json')
            // console.log("COLUMN JSON:")
            // console.log(userJobTitles2)
            // userJobTitles3 = {
            //     'state': {
            //         Admin: 'Admin',
            //         IT: randomnum,
            //         General : 'General',
            //         Security : 'Security',
            //         CEO : 'CEO',
            //     },
            //     'zip': {
            //         Admin: 'Admin',
            //         CEO: randomnum
            //     },
            //     'businesstype': {
            //         BusinessType_1: 'BT 1',
            //         BusinessType_2: 'BT 2'
            //     }
            // };
            // var userJobTitles = {
            //     'state': {
            //         Admin: 'Admin',
            //         IT: randomnum,
            //         General : 'General',
            //         Security : 'Security',
            //         CEO : 'CEO',
            //     },
            //     'zip': {
            //         Admin: 'Admin',
            //         CEO: randomnum
            //     }
            // };
            </script>

    <script>
    //     var userJobTitles8
    //     $.get("http://localhost:5000/data_test/businesstype.json", function(data){
    //         userJobTitles8 = data
    //         console.log(userJobTitles8)
    
    //     })
    //     userJobTitles8 = {
    //         'state': {
    //             Admin: 'Admin',
    //             IT: randomnum,
    //             General : 'General',
    //             Security : 'Security',
    //             CEO : 'CEO',
    //         },
    //         'zip': {
    //             Admin: 'Admin',
    //             CEO: randomnum
    //         },
    //         'businesstype': {
    //             BusinessType_1: 'BT 1',
    //             BusinessType_2: 'BT 2'
    //         }
    //     };
    // </script>
    <script>
    //     console.log("OUTSIDE")
    //     console.log(userJobTitles8)   
    //     // var userJobTitles7 = new Object()

        // $.getJSON("http://localhost:5000/data_test/businesstype.json").then(
        //     function(data, userJobTitles7) {
        //         console.log('MY JSON:')
        //         console.log(Object.keys(data))
        //         userJobTitles7 = data

        //     }
        // )
        // console.log("OUTSIDE IT")
        // console.log(userJobTitles7)
        // var myjson = userJobTitles6

        // GET example
        // makeRequest('GET', "http://localhost:5000/data_test/businesstype.json").then(function(data){
        //     var userJobTitles4=JSON.parse(data);
        // console.log("NEW")
        // console.log(userJobTitles4)
        // console.log("NEWEST:")
        // console.log(userJobTitles6)
        // });
    </script>

    <!-- 
    <script>
    // var checkbox2 = document.querySelector(".toggle-all");
    var checkbox2 = document.getElementsByClassName("toggle-all")[0];
    console.log("AFTER VARIABLE DECLARATION")
    console.log(checkbox2)
    checkbox2.addEventListener( 'change', function() {
        if(this.checked) {
            console.log("QUERY CHECKED")
            // Checkbox is checked..
        } else {
            // Checkbox is not checked..
            console.log("QUERY UNCHECKED")
            // checkbox2.checked = true;
        }
    });
    </script> -->

    <!-- Old table reset -->
    <!-- <script>
        $(function() {
            $resetButton.click(function () {
                $table.bootstrapTable('removeAll')
                $table.bootstrapTable('resetSearch') // Clear value in global search box
                $table.bootstrapTable('clearFilterControl') //Unfilter results
                $table.bootstrapTable('refreshOptions', { //Clear column filters
                })
            })
        })
    </script> -->

    <!-- <script>
    // function rebuild() {
        //     console.log("IN REBUILD")
        //     $('#table')
        //         .bootstrapTable('destroy')
        //         // .bootstrapTable()
        //         .bootstrapTable('showLoading')
        // }
        
        // rebuild()
    </script> -->











</body>
</html>